\RequirePackage{media9}

\ProvidesExplPackage{media9patch}{\g@mix@date@tl}{\g@mix@version@tl}
{acrobat-9/X compatible media}

\ProcessKeysOptions{media9}

\bool_if:NT\g_mix_pkgbigfiles_bool{
  \special{!~(./\jobname.m9)~run~}
  %open auxiliary file \jobname.m9 for writing hex encoded streams
  %of media files. This file is read and executed during ps2pdf
  %conversion.
  \iow_new:N\g_mix_mstreams_stream
  \iow_open:Nn\g_mix_mstreams_stream{\jobname.m9}
  \iow_now:Nn\g_mix_mstreams_stream{
    1~dict~
    /o{mark/_objdef}bind~def/O{/type/stream/OBJ~pdfmark}bind~def
    /m~systemdict/mark~get~def
    /P{/ASCIIHexDecode~filter/PUT~pdfmark}bind~def
    /C{/CLOSE~pdfmark}bind~def
  }
}
\bool_if:NT\g_mix_pkgbigfiles_bool{
  \RequirePackage{atenddvi}
  \AtEndDvi{
    \iow_close:N\g_mix_mstreams_stream
  }
}
